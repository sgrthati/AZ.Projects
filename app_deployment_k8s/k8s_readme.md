# Table of contents
- [Table of contents](#table-of-contents)
  - [Understanding K8s Objects](#understanding-k8s-objects)
  - [to provision AKS Cluster](#to-provision-aks-cluster)
  - [app deployment using deployments object](#app-deployment-using-deployments-object)
  - [app deployment using statefulset object](#app-deployment-using-statefulset-object)
  - [Nginx Ingress](#nginx-ingress)
      - [without TLS](#without-tls)
      - [with TLS](#with-tls)
  - [logging](#logging)

## Understanding K8s Objects

Here I explored how Kubernetes objects behave in a cluster, and tried to use most of the objects that are required in the majority of use cases.

## to provision AKS Cluster

1.inside aks_cluster,change the variable resource_group_name with exisitng resource group name

    cd ./app_deployment_k8s/aks_cluster
    terraform apply

2.it will provision AKS cluster,here we are going to perform k8s labs

## app deployment using deployments object

#below commands going to install Helloworld v1&2 app by using Deployments,secrets,configmap,azure cloud supported PVC,Storage class and namespace

    cd app_deployment_k8s/
    kubectl apply -f 1.app/deployment

## app deployment using statefulset object

#below command going to install Helloworld v1&2 app by using Statefulset,secrets,configmap,azure cloud supported PVC,Storage class and namespace

    cd app_deployment_k8s/
    kubectl apply -f 1.app/statefulset

## Nginx Ingress

#### without TLS

1.by using helm chart,we are going to install nginx ingress in our cluster

    ./2.ingress/install_ingress.sh

2.apply ingress.yaml

    kubectl apply -f .2.ingress/ingress.yaml

3.to connect nginx_ingress,get the publicip from installed nginx service

    kubectl get svc nginx-ingress-nginx-ingress-controller -n ingress-nginx -o jsonpath='{.status.loadBalancer.ingress[0].ip}'

4.to connect helloworld v1 app

    http://<nginx-ingress-public-ip>/hellov1

5.to connect helloworld v2 app

    http://<nginx-ingress-public-ip>/hellov2

#### with TLS

1.by using helm chart,we are going to install nginx ingress in our cluster

    ./2.ingress/install_ingress.sh

2.Create a new certificate

Generate a new certificate using the following command:

    ./create-certificate-azuredns.sh

    #usage:
        This script automates the process of generating SSL certificates for a domain using Azure DNS and Certbot. Here's a high-level overview of what the script does:
            - Installs dependencies, including Azure CLI and Certbot.
            - Configures Azure CLI and logs in to Azure.
            - Creates a Python virtual environment and installs Certbot.
            - Generates a Certbot credentials file for Azure DNS.
            - Uses Certbot to generate or refresh an SSL certificate for the specified domain.
            - Copies the generated certificate files to a specified location.
            - Removes unnecessary files and logs generated by Certbot.
            - Converts the certificate to PFX format using OpenSSL.
            - The script assumes that the domain is hosted on Azure DNS and that the Azure CLI is not already 

3.Create a secret
Create a secret using the following command:

    kubectl create secret tls hello-world-tls --key generated_certs/private.key --cert generated_certs/public.crt -n learning

4.apply ingress.yaml

    kubectl apply -f .2.ingress/ingress_with_tls.yaml

5.create a A DNS Record for your domain

    az dns record-set a add-record -g <resource_group_name> -z <zone_name> -n <record_name> --ipv4-address <public_ip>

6.to connect helloworld v1 app

    https://<domain>/hellov1

7.to connect helloworld v2 app

    https://<domain>/hellov2

## logging

#here I am going to install prometheus and grafana in our cluster,and we are going to perform observability labs

1.to install prometheus and grafana via helm

    ./3logging/install_prometheus_grafana.sh

2.above script will print grafana endoint along
with credentials,login with them

3.check weather prometheus datasource added in grafana

4.in dashboard import k8s relatreddashboards to see the metrics







    